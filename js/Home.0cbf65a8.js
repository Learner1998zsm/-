"use strict";(self["webpackChunkhmtt"]=self["webpackChunkhmtt"]||[]).push([[268],{3599:function(t,e,n){n.r(e),n.d(e,{default:function(){return E}});var s=function(){var t=this,e=t._self._c;return e("div",[e("div",[e("van-nav-bar",{attrs:{fixed:""},scopedSlots:t._u([{key:"left",fn:function(){return[e("img",{staticClass:"logo",attrs:{src:n(8998),alt:""}})]},proxy:!0},{key:"right",fn:function(){return[e("van-icon",{attrs:{name:"search",size:"0.48rem",color:"#fff"},on:{click:function(e){return t.$router.push("/search")}}})]},proxy:!0}])})],1),e("div",{staticClass:"main"},[e("van-tabs",{attrs:{color:"#007bff",animated:"",sticky:"","offset-top":"1.226667rem"},on:{change:t.tabChangeHandler},model:{value:t.channel_id,callback:function(e){t.channel_id=e},expression:"channel_id"}},t._l(t.userChannels,(function(n){return e("van-tab",{key:n.id,attrs:{name:n.id,title:n.name}},[e("ArticleList",{attrs:{id:t.channel_id}})],1)})),1),e("van-icon",{staticClass:"moreChannels",attrs:{name:"plus",size:"0.37333rem",color:"#000"},on:{click:t.addChannel}})],1),e("van-popup",{staticClass:"channel_popup",attrs:{"get-container":"body"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[e("ChannelEdit",{ref:"edit",attrs:{userChannels:t.userChannels,moreChannels:t.moreChannels},on:{cancelEdit:t.closePopup,deleteChannelEV:t.deleteChannelFn,addChannelEV:t.addChannelFn}})],1)],1)},a=[],i=function(){var t=this,e=t._self._c;return e("div",[e("div",[e("van-nav-bar",{attrs:{title:"频道管理"},scopedSlots:t._u([{key:"right",fn:function(){return[e("van-icon",{attrs:{name:"cross",size:"0.37333rem",color:"#fff"},on:{click:function(e){return t.$emit("cancelEdit")}}})]},proxy:!0}])})],1),e("div",[e("div",{staticClass:"title-box"},[e("span",[t._v(" 我的频道 "),t.isEdit?e("span",{staticClass:"small-title"},[t._v("点击删除频道")]):e("span",{staticClass:"small-title",on:{click:function(e){return t.$emit("cancelEdit")}}},[t._v("点击进入频道")])]),e("span",{on:{click:function(e){t.isEdit=!t.isEdit}}},[t._v(" "+t._s(t.isEdit?"完成":"编辑")+" ")])]),e("van-row",{attrs:{type:"flex"}},t._l(t.userChannels,(function(n,s){return e("van-col",{key:n.id,attrs:{span:"6"},on:{click:function(e){return t.deleteChannels(n,s)}}},[e("div",{staticClass:"channel-item"},[t._v(" "+t._s(n.name)+" "),"推荐"!==n.name&&t.isEdit?e("van-badge",{staticClass:"cross-badge",attrs:{color:"transparent"},scopedSlots:t._u([{key:"content",fn:function(){return[e("van-icon",{attrs:{name:"cross",size:"0.32rem",color:"#cfcfcf"}})]},proxy:!0}],null,!0)}):t._e()],1)])})),1),t._m(0),e("van-row",{attrs:{type:"flex"}},t._l(t.moreChannels,(function(n){return e("van-col",{key:n.id,attrs:{span:"6"},on:{click:function(e){return t.addChannel(n)}}},[e("div",{staticClass:"channel-item"},[t._v(t._s(n.name))])])})),1)],1)])},l=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"title-box"},[e("span",[t._v("点击添加更多频道：")])])}],r={name:"ChannelEdit",props:{userChannels:{type:Array,default:()=>[]},moreChannels:{type:Array,default:()=>[]}},data(){return{isEdit:!1}},methods:{deleteChannels(t,e){if(this.isEdit){if("推荐"==t.name)return this.$emit("cancelEdit",0);this.$emit("deleteChannelEV",e)}else this.$emit("cancelEdit",t.id)},addChannel(t){this.isEdit&&this.$emit("addChannelEV",t)}}},c=r,o=n(1001),h=(0,o.Z)(c,i,l,!1,null,"b9964eb2",null),d=h.exports,u=function(){var t=this,e=t._self._c;return e("div",[e("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了","immediate-check":!1,offset:"50"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.articleList,(function(n){return e("ArticleItem",{key:n.art_id,attrs:{id:n.art_id,title:n.title,pubdate:n.pubdate,author:n.aut_name,"comm-count":n.comm_count,cover:n.cover},nativeOn:{click:function(e){return t.$router.push(`/article_detail?aid=${n.art_id}`)}}})})),1)],1)],1)},m=[],f=n(9215),p={name:"ArticleList",props:["id"],components:{ArticleItem:f.Z},data(){return{articleList:[],loading:!1,finished:!1,timestamp:+new Date,refreshing:!1}},created(){this.getArticleList()},methods:{async getArticleList(t="load"){const e={channel_id:this.id,timestamp:this.timestamp},n=await this.$API.reqArticleList(e);if(200===n.status){const{results:e,pre_timestamp:s}=n.data.data;if("load"===t?(this.articleList=[...this.articleList,...e],this.loading=!1):(this.articleList=e,this.refreshing=!1),null===s)return this.finished=!0;this.timestamp=s}},onLoad(){0!==this.articleList.length&&this.getArticleList()},onRefresh(){this.timestamp=+new Date,this.getArticleList("refresh")}}},C=p,v=(0,o.Z)(C,u,m,!1,null,null,null),_=v.exports,g={name:"Home",components:{ArticleList:_,ChannelEdit:d},data(){return{channel_id:0,userChannels:[],allChannels:[],show:!1,channelScrollTObj:{}}},methods:{async getAllChannelList(){try{const t=await this.$API.reqAllChannelList();this.allChannels=t.data.data.channels}catch(t){console.log(t.message)}},async getUserChannelList(){try{const t=await this.$API.reqUserChannelList();this.userChannels=t.data.data.channels}catch(t){console.log(t.message)}},tabChangeHandler(t,e){this.channel_id=t,this.$nextTick((()=>{document.documentElement.scrollTop=this.channelScrollTObj[this.channel_id]}))},addChannel(){this.show=!0,this.$nextTick((()=>{this.$refs.edit.isEdit=!1}))},closePopup(t){this.show=!1,(t||0===t)&&(this.channel_id=t)},deleteChannelFn(t){this.userChannels.splice(t,1),this.syncUserChannels()},addChannelFn(t){this.userChannels.push(t),this.syncUserChannels()},async syncUserChannels(){const t=this.userChannels.map(((t,e)=>({id:t.id,seq:e+1})));await this.$API.reqSetChannels(t),this.getUserChannelList()},scrollFn(){this.$route.meta.scrollT=document.documentElement.scrollTop,this.channelScrollTObj[this.channel_id]=document.documentElement.scrollTop}},created(){this.getUserChannelList(),this.getAllChannelList()},activated(){window.addEventListener("scroll",this.scrollFn),document.documentElement.scrollTop=this.$route.meta.scrollT},deactivated(){window.removeEventListener("scroll",this.scrollFn)},computed:{moreChannels(){const{userChannels:t,allChannels:e}=this;return e.filter((e=>t.every((t=>t.id!==e.id))))}}},y=g,k=(0,o.Z)(y,s,a,!1,null,"11aae060",null),E=k.exports},8998:function(t,e,n){t.exports=n.p+"img/toutiao_logo.4653c8be.d0d391a4.png"}}]);
//# sourceMappingURL=Home.0cbf65a8.js.map